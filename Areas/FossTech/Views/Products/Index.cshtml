@model IEnumerable<FossTech.Models.ProductModels.Product>

@{
    ViewData["Title"] = "Products";
}


<div class="col-sm-12">
    <div class="card">
        <div class="card-header pb-1 d-flex justify-content-between">
            <div><h2>Products</h2></div>
            <div>
                <button id="deleteButton" class="btn btn-primary" style="background-color: red; border: none;">Delete Selected</button>
                <a class="btn btn-primary " style=" background-color: orange; border: none;" asp-action="ExporttoExcel">Download</a>
                <a class="btn btn-primary" style="border: none;" asp-action="Create">Create New</a>
            </div>
        </div>
        <div class="card-body">
            <div class="dt-responsive table-responsive">
                <table id="simpletable" class="table table-striped table-bordered nowrap">
                    <thead>
                        <tr>
                            <th><input style="width:30px; height: 40px; " type="checkbox" id="selectAll" /></th>
                            <th class="no-sort">Action</th>
                            <th>
                                @Html.DisplayNameFor(model => model.Section)
                            </th>
                            <th>
                                @Html.DisplayNameFor(model => model.Image)
                            </th>
                            <th>
                                @Html.DisplayNameFor(model => model.Name)
                            </th>
                            <th>
                                @Html.DisplayNameFor(model => model.SortOrder)
                            </th>
                            @*<th>
                                    @Html.DisplayNameFor(model => model.ProductCategories)
                                </th>
                                <th>
                                    @Html.DisplayNameFor(model => model.ProductSubCategories)
                                </th>*@
                            <th>
                                @Html.DisplayNameFor(model => model.FinalPrice)
                            </th>
                            <th>
                                @Html.DisplayNameFor(model => model.Status)
                            </th>

                        </tr>
                    </thead>
                    <tbody>
                    @foreach (var item in Model)
                    {
                        <tr>
                                <td class="form-check">
                                    <div class="" style="padding-left: inherit;">
                                        <input data-id="@item.Id" class="check-input checkbox-item" style="width:30px; height: 40px; " type="checkbox">
                                    </div>
                                </td>
                            <td class="dropdown">
                                    <button type="button" class="btn btn-primary" data-toggle="dropdown" aria-expanded="false"><i class="fa fa-cog" ></i></button>
                                    <ul class="dropdown-menu">
                                        <li> <a class="dropdown-item text-primary" asp-area="FossTech" asp-action="Details" asp-route-id="@item.Id"><i class="icofont icofont-eye-alt"></i>View</a></li>
                                        <li><a class="dropdown-item text-success" asp-action="Edit" asp-route-id="@item.Id"><i class="icofont icofont-edit"></i>Edit</a></li>
                                        <li><a class="dropdown-item text-warning" asp-action="Edit1" asp-route-id="@item.Id"><i class="icofont icofont-edit"></i>Variants</a></li>
                                        <li><a class="dropdown-item text-danger" asp-action="Delete" asp-route-id="@item.Id"><i class="icofont icofont-ui-delete"></i>Delete</a></li>
                                    </ul>
                            </td>
                                <td>
                                    @Html.DisplayFor(modelItem => item.Section.Name)
                                </td>
                            <td>
                                <img width="100" src="@Html.DisplayFor(modelItem => item.Image)" alt="@item.Name" />
                            </td>
                            <td>
                                @Html.DisplayFor(modelItem => item.Name)
                            </td>
                                <td>
                                    @Html.DisplayFor(modelItem => item.SortOrder)
                                </td>
                                
                            @*<td>
            <ul>
                @foreach (var category in item.ProductCategories)
                {
                    <li>@category.Category.Name</li>
                }
            </ul>
        </td>
        <td>
            <ul>
                @foreach (var subCategory in item.ProductSubCategories)
                {
                    <li>@subCategory.SubCategory.Name</li>
                }
            </ul>
        </td>*@
                            <td>
                                @Html.DisplayFor(modelItem => item.FinalPrice)
                            </td>

                            <td>
                                @Html.DisplayFor(modelItem => item.Status)
                            </td>

                        </tr>
                    }
                    </tbody>
                </table>
            </div>
        </div>
    </div>
</div>





@section styles {
    <link rel="stylesheet" type="text/css" href="/lib/DataTables/DataTables-1.10.20/css/jquery.dataTables.min.css" />
    <link rel="stylesheet" type="text/css" href="/lib/DataTables/Buttons-1.6.1/css/buttons.dataTables.min.css" />
}

@section Scripts {
    <script type="text/javascript" src="/lib/DataTables/DataTables-1.10.20/js/jquery.dataTables.min.js"></script>
    <script type="text/javascript" src="/lib/DataTables/JSZip-2.5.0/jszip.min.js"></script>
    <script type="text/javascript" src="/lib/DataTables/Buttons-1.6.1/js/dataTables.buttons.min.js"></script>
    <script type="text/javascript" src="/lib/DataTables/pdfmake-0.1.36/pdfmake.min.js"></script>
    <script type="text/javascript" src="/lib/DataTables/pdfmake-0.1.36/vfs_fonts.js"></script>
    <script type="text/javascript" src="/lib/DataTables/Buttons-1.6.1/js/buttons.html5.min.js"></script>
    <script type="text/javascript" src="/lib/DataTables/Buttons-1.6.1/js/buttons.print.min.js"></script>

    <script type="text/javascript">
        $(document).ready(function() {
            $('#simpletable').DataTable({
                dom: 'lBfrtip',
                buttons: [{
                        extend: 'pdf',
                        title: 'items',
                        filename: "@DateTime.Now.ToFileTime()",
                        exportOptions: {
                            columns: [1, 2, 3 ,4]
                        }
                    }, {
                        extend: 'excel',
                        title: 'items',
                        filename: "@DateTime.Now.ToFileTime()",
                        exportOptions: {
                            columns: [1, 2, 3, 4]
                        }
                    }, {
                        extend: 'csv',
                        title: 'items',
                        filename: "@DateTime.Now.ToFileTime()",
                        exportOptions: {
                            columns: [1, 2, 3, 4]
                        }
                    },
                    {
                        extend: 'print',
                        title: 'items',
                        filename: "@DateTime.Now.ToFileTime()",
                        exportOptions: {
                            columns: [1, 2, 3, 4]
                        }
                    }],
                "order": [],
                "columnDefs": [ {
                    "targets"  : 'no-sort',
                    "orderable": false,
                }],

            });

            // Select or deselect all checkboxes when the "Select All" checkbox is clicked
            $('#selectAll').change(function () {
                $('.checkbox-item').prop('checked', $(this).prop('checked'));
            });

            var itemIds = [];

            // Add click event handler to the delete button
            $('#deleteButton').click(function () {
                var selectedItems = $('.checkbox-item:checked');

                selectedItems.each(function () {
                    var leadId = parseInt($(this).attr("data-id"));
                    itemIds.push(leadId);
                });

                // Send the selected item IDs to the server for deletion
                $.ajax({
                    url: '/FossTech/Products/DeleteSelected',
                    type: 'POST', // Add this line if necessary
                    data: { leadIds: itemIds },
                    success: function (response) {

                        if (response == "Success") {
                            selectedItems.closest('tr').remove();
                            itemIds = [];
                            window.location.reload();
                        }
                    },
                    error: function (xhr, status, error) {
                        // Handle the error response
                        console.log(error);
                    }
                });

            });

        });

    </script>
}