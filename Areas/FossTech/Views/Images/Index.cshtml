@model IEnumerable<FossTech.Models.Image>

@{
    ViewData["Title"] = "Index";
}

<div class="col-sm-12">
    <!-- Zero config.table start -->
    <div class="card">
        <div class="card-header pb-1 d-flex justify-content-between">
            <div><h2>Gallery Images</h2>
               </div>
            <div>
                <button id="deleteButton" class="btn btn-primary" style="background-color: red; border: none;">Delete Selected</button>
                <button type="button" class="btn btn-primary waves-effect" data-toggle="modal" data-target="#default-Modal">Add New Images</button>
                @* <a class="btn btn-primary float-right" asp-action="Create">Create New</a> *@
            </div>
            
        </div>
        <div class="card-body">
            <div class="dt-responsive table-responsive">
                <table id="simpletable" class="table table-striped table-bordered nowrap">
                    <thead>
                        <tr>
                            <th><input style="width:30px; height: 40px; " type="checkbox" id="selectAll" /></th>
                            <th class="no-sort">Action</th>
                            <th>
                                Image
                            </th>
                            <th>
                                @Html.DisplayNameFor(model => model.Title)
                            </th>
                            <th>
                                @Html.DisplayNameFor(model => model.Category)
                            </th>
                            <th>
                                @Html.DisplayNameFor(model => model.Order)
                            </th>
                            
                        </tr>
                    </thead>
                    <tbody>
                        @foreach (var item in Model)
                        {
                        <tr>
                                <td class="form-check">
                                    <div class="" style="padding-left: inherit;">
                                        <input data-id="@item.Id" class="check-input checkbox-item" style="width:30px; height: 40px; " type="checkbox">
                                    </div>
                                </td>
                            <td class="dropdown">
                                <button type="button" class="btn btn-primary" data-toggle="dropdown" aria-expanded="false"><i class="fa fa-cog"></i></button>
                                    <ul class="dropdown-menu">
                                        <li><a class="dropdown-item text-success" asp-action="Edit" asp-route-id="@item.Id"><i class="icofont icofont-edit"></i>Edit</a></li>
                                        <li><a class="dropdown-item text-danger" asp-action="Delete" asp-route-id="@item.Id"><i class="icofont icofont-ui-delete"></i>Delete</a></li>
                                    </ul>
                            </td>
                            <td>
                                <img src="@Url.Content(item.Img)" width="100" alt="" />
                            </td>
                            <td>
                                @Html.DisplayFor(modelItem => item.Title)
                            </td>
                                <td>
                                    @Html.DisplayFor(modelItem => item.Category)
                                </td>
                            <td>
                                @Html.DisplayFor(modelItem => item.Order)
                            </td>

                        </tr>
                        }
                    </tbody>
                </table>
            </div>
        </div>
    </div>
</div>

<div class="modal fade" id="default-Modal" tabindex="-1" role="dialog">
    <div class="modal-dialog" role="document">
        <div class="modal-content">
            <div class="modal-header">
                <h4 class="modal-title">Add new Images</h4>
                <button type="button" class="close btn btn-primary" data-bs-dismiss="modal" aria-label="Close">
                    <span aria-hidden="true">&times;</span>
                </button>
            </div>
            <form enctype="multipart/form-data" asp-action="Create">
                <div class="modal-body">
                    <div class="form-group mb-3">
                        <label class="">Upload Images</label>
                        <input type="file" name="images" multiple accept="image/*" required="" class="form-control" onchange="checkImageSize(event)">
                        <span style="color: red;" id="image-size-error"></span>
                    </div>
                </div>
                <div class="modal-footer">
                    <button type="button" class="btn btn-default waves-effect " data-bs-dismiss="modal">Close</button>
                    <button type="submit" class="btn btn-primary waves-effect waves-light ">Upload Images</button>
                </div>
            </form>
        </div>
    </div>
</div>

@section styles {
    <link rel="stylesheet" type="text/css" href="/lib/DataTables/DataTables-1.10.20/css/jquery.dataTables.min.css" />
    <link rel="stylesheet" type="text/css" href="/lib/DataTables/Buttons-1.6.1/css/buttons.dataTables.min.css" />
}

@section Scripts {
    <script type="text/javascript" src="/lib/DataTables/DataTables-1.10.20/js/jquery.dataTables.min.js"></script>
    <script type="text/javascript" src="/lib/DataTables/JSZip-2.5.0/jszip.min.js"></script>
    <script type="text/javascript" src="/lib/DataTables/Buttons-1.6.1/js/dataTables.buttons.min.js"></script>
    <script type="text/javascript" src="/lib/DataTables/pdfmake-0.1.36/pdfmake.min.js"></script>
    <script type="text/javascript" src="/lib/DataTables/pdfmake-0.1.36/vfs_fonts.js"></script>
    <script type="text/javascript" src="/lib/DataTables/Buttons-1.6.1/js/buttons.html5.min.js"></script>
    <script type="text/javascript" src="/lib/DataTables/Buttons-1.6.1/js/buttons.print.min.js"></script>

    <script type="text/javascript">
        $(document).ready(function () {
            $('#simpletable').DataTable({
                dom: 'lBfrtip',
                buttons: [{
                    extend: 'pdf',
                    title: 'items',
                    filename: "@DateTime.Now.ToFileTime()",
                    exportOptions: {
                        columns: [0, 1, 2]
                    }
                }, {
                    extend: 'excel',
                    title: 'items',
                    filename: "@DateTime.Now.ToFileTime()",
                    exportOptions: {
                        columns: [0, 1, 2]
                    }
                }, {
                    extend: 'csv',
                    title: 'items',
                    filename: "@DateTime.Now.ToFileTime()",
                    exportOptions: {
                        columns: [0, 1, 2]
                    }
                },
                {
                    extend: 'print',
                    title: 'items',
                    filename: "@DateTime.Now.ToFileTime()",
                    exportOptions: {
                        columns: [0, 1, 2]
                    }
                }],
                "order": [],
                "columnDefs": [{
                    "targets": 'no-sort',
                    "orderable": false,
                }],

            });


            // Select or deselect all checkboxes when the "Select All" checkbox is clicked
            $('#selectAll').change(function () {
                $('.checkbox-item').prop('checked', $(this).prop('checked'));
            });

            var itemIds = [];

            // Add click event handler to the delete button
            $('#deleteButton').click(function () {
                var selectedItems = $('.checkbox-item:checked');

                selectedItems.each(function () {
                    var leadId = parseInt($(this).attr("data-id"));
                    itemIds.push(leadId);
                });

                // Send the selected item IDs to the server for deletion
                $.ajax({
                    url: '/FossTech/Images/DeleteSelected',
                    type: 'POST', // Add this line if necessary
                    data: { leadIds: itemIds },
                    success: function (response) {

                        if (response == "Success") {
                            selectedItems.closest('tr').remove();
                            itemIds = [];
                            window.location.reload();
                        }
                    },
                    error: function (xhr, status, error) {
                        // Handle the error response
                        console.log(error);
                    }
                });

            });

        });

    </script>
    <script>
        function checkImageSize(event) {
            const fileInput = event.target;
            const maxSizeKB = 250;
            const maxBytes = maxSizeKB * 1024; // Convert KB to bytes

            // Check if any file is selected
            if (fileInput.files && fileInput.files.length > 0) {
                const files = fileInput.files;
                let isValidSize = true;

                // Iterate through each selected file and check its size
                for (let i = 0; i < files.length; i++) {
                    const fileSize = files[i].size;
                    if (fileSize > maxBytes) {
                        isValidSize = false;
                        break;
                    }
                }

                // Update the error message in the span element
                const errorSpan = document.getElementById('image-size-error');
                if (!isValidSize) {
                    errorSpan.textContent = 'Please upload an image size up to 250KB.';
                    fileInput.value = ''; // Reset the file input if an invalid image is selected
                } else {
                    errorSpan.textContent = '';
                }
            }
        }

    </script>
}