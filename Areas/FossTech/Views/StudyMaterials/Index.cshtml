@model IEnumerable<FossTech.Models.StudyMaterialModels.StudyMaterial>

@{
    ViewData["Title"] = "Index";
}
<div class="col-sm-12">
    <div class="card">
        <div class="card-header pb-1 d-flex justify-content-between">
            <div><h2>Study Material</h2></div>
            <div>
                <a class="btn btn-primary" style="border: none;" asp-action="Create">Create New</a>
            </div>
        </div>
        <div class="card-body">
            <div class="dt-responsive table-responsive">
                <table id="simpletable" class="table table-striped table-bordered nowrap">
                    <thead>
                        <tr>
                            <th>Actions</th>
                            <th>@Html.DisplayNameFor(model => model.Name)</th>
                            <th>@Html.DisplayNameFor(model => model.ThumbnailImage)</th>
                            <th>@Html.DisplayNameFor(model => model.PDFs)</th>
                            <th>@Html.DisplayNameFor(model => model.SortOrder)</th>
                            <th>@Html.DisplayNameFor(model => model.Board)</th>
                            <th>@Html.DisplayNameFor(model => model.Standard)</th>
                            <th>@Html.DisplayNameFor(model => model.Subject)</th>
                            <th>@Html.DisplayNameFor(model => model.Chapter)</th>
                            <th>@Html.DisplayNameFor(model => model.IsPaid)</th>
                        </tr>
                    </thead>
                    <tbody>
                        @foreach (var item in Model)
                        {
                            <tr>
                                <td class="dropdown">
                                    <button type="button" class="btn btn-primary dropdown-toggle" data-toggle="dropdown" aria-haspopup="true" aria-expanded="false"><i class="fa fa-cog" aria-hidden="true"></i></button>
                                    <div class="dropdown-menu dropdown-menu-right b-none contact-menu" x-placement="top-end" style="position: absolute; transform: translate3d(-77px, -95px, 0px); top: 0px; left: 0px; will-change: transform;">
                                        <a class="dropdown-item text-success" asp-action="Edit" asp-route-id="@item.Id"><i class="icofont icofont-edit"></i>Edit</a>
                                        <a class="dropdown-item text-danger" asp-action="Delete" asp-route-id="@item.Id"><i class="icofont icofont-ui-delete"></i>Delete</a>
                                    </div>
                                </td>
                                <td>@Html.DisplayFor(modelItem => item.Name)</td>
                                <td>
                                    <img src="@Html.DisplayFor(modelItem => item.ThumbnailImage)" width="50px" />
                                </td>
                                <td>
                                    @if (item.PDFs != null && item.PDFs.Any())
                                    {
                                        <ul>
                                            @foreach (var pdf in item.PDFs)
                                            {
                                                <li>
                                                    <a href="#" class="open-pdf-modal" data-pdf="@Url.Content(pdf.PDF)" data-title="PDF Title">
                                                        <iframe src="@Url.Content(pdf.PDF)" width="50" height="50" style="border: none;"></iframe>
                                                    </a>
                                                </li>
                                            }
                                        </ul>
                                    }
                                </td>
                                <td>@Html.DisplayFor(modelItem => item.SortOrder)</td>
                                <td>@Html.DisplayFor(modelItem => item.Board.Name)</td>
                                <td>@Html.DisplayFor(modelItem => item.Standard.Name)</td>
                                <td>@Html.DisplayFor(modelItem => item.Subject.Name)</td>
                                <td>@Html.DisplayFor(modelItem => item.Chapter.Name)</td>
                                <td>@Html.DisplayFor(modelItem => item.IsPaid)</td>
                            </tr>
                        }
                    </tbody>
                </table>
            </div>
        </div>
    </div>
</div>

<!-- PDF Modal -->
<div class="modal fade" id="pdfModal" tabindex="-1" role="dialog" aria-labelledby="pdfModalLabel" aria-hidden="true">
    <div class="modal-dialog modal-lg" role="document">
        <div class="modal-content">
            <div class="modal-header">
                <h5 class="modal-title" id="pdfModalLabel">PDF Viewer</h5>
                <button type="button" class="close" data-bs-dismiss="modal" aria-label="Close">
                    <span aria-hidden="true">&times;</span>
                </button>
            </div>
            <div class="modal-body">
                <iframe id="pdfIframe" src="" width="100%" height="500px" style="border: none;"></iframe>
            </div>
        </div>
    </div>
</div>

@section styles {
    <link rel="stylesheet" type="text/css" href="/lib/DataTables/DataTables-1.10.20/css/jquery.dataTables.min.css" />
    <link rel="stylesheet" type="text/css" href="/lib/DataTables/Buttons-1.6.1/css/buttons.dataTables.min.css" />
}

@section Scripts {
    <script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>
    <script src="https://stackpath.bootstrapcdn.com/bootstrap/5.3.0-alpha1/js/bootstrap.bundle.min.js"></script>

    <script type="text/javascript" src="/lib/DataTables/DataTables-1.10.20/js/jquery.dataTables.min.js"></script>
    <script type="text/javascript" src="/lib/DataTables/JSZip-2.5.0/jszip.min.js"></script>
    <script type="text/javascript" src="/lib/DataTables/Buttons-1.6.1/js/dataTables.buttons.min.js"></script>
    <script type="text/javascript" src="/lib/DataTables/pdfmake-0.1.36/pdfmake.min.js"></script>
    <script type="text/javascript" src="/lib/DataTables/pdfmake-0.1.36/vfs_fonts.js"></script>
    <script type="text/javascript" src="/lib/DataTables/Buttons-1.6.1/js/buttons.html5.min.js"></script>
    <script type="text/javascript" src="/lib/DataTables/Buttons-1.6.1/js/buttons.print.min.js"></script>

    <script type="text/javascript">
        $(document).ready(function () {
            $('#simpletable').DataTable({
                dom: 'lBfrtip',
                buttons: [{
                    extend: 'pdf',
                    title: 'items',
                    filename: "@DateTime.Now.ToFileTime()",
                    exportOptions: {
                        columns: [1, 2, 3, 4]
                    }
                }, {
                    extend: 'excel',
                    title: 'items',
                    filename: "@DateTime.Now.ToFileTime()",
                    exportOptions: {
                        columns: [1, 2, 3, 4]
                    }
                }, {
                    extend: 'csv',
                    title: 'items',
                    filename: "@DateTime.Now.ToFileTime()",
                    exportOptions: {
                        columns: [1, 2, 3, 4]
                    }
                }, {
                    extend: 'print',
                    title: 'items',
                    filename: "@DateTime.Now.ToFileTime()",
                    exportOptions: {
                        columns: [1, 2, 3, 4]
                    }
                }],
                "order": [],
                "columnDefs": [{
                    "targets": 'no-sort',
                    "orderable": false,
                }]
            });

            // Open modal and set PDF source
            $(".open-pdf-modal").click(function (e) {
                e.preventDefault();  // Prevent default link behavior
                var pdfUrl = $(this).data("pdf");  // Get PDF URL from the data attribute
                var title = $(this).data("title"); // Optionally use title for the modal header
                $("#pdfModalLabel").text(title);  // Set the title in the modal (optional)
                $("#pdfIframe").attr("src", pdfUrl);  // Set the iframe src to the PDF URL

                // Show the modal
                $("#pdfModal").modal("show");
            });

            // Optional: Close modal and clear iframe src
            $("#pdfModal").on('hidden.bs.modal', function () {
                $("#pdfIframe").attr("src", "");  // Clear iframe source when modal is closed
            });
        });
    </script>
}
